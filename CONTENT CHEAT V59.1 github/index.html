<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CONTENT CHEAT v59.1 © Brata Hanggara Putra</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        html { scroll-behavior: smooth; }
        body { 
            font-family: 'Inter', sans-serif;
            background-color: #0D1120;
            background-image: radial-gradient(at 27% 37%, hsla(215, 98%, 22%, 0.2) 0px, transparent 50%), radial-gradient(at 97% 21%, hsla(212, 98%, 23%, 0.2) 0px, transparent 50%), radial-gradient(at 70% 94%, hsla(282, 98%, 23%, 0.2) 0px, transparent 50%), radial-gradient(at 10% 29%, hsla(282, 98%, 23%, 0.2) 0px, transparent 50%);
            color: #E0E0E0;
        }
        .glass-effect {
            background: rgba(17, 24, 39, 0.6);
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border-radius: 1.5rem; border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }
        .modern-input, .modern-input-group {
            background-color: rgba(0, 0, 0, 0.2); border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        .modern-input:focus {
            outline: none; border-color: rgba(167, 139, 250, 0.8);
            box-shadow: 0 0 0 3px rgba(167, 139, 250, 0.2);
        }
        select.modern-input option { background: #0D1120; color: #E0E0E0; }
        .modern-btn {
            background: linear-gradient(90deg, #5F00D8, #A78BFA); border: none;
            transition: all 0.3s ease; box-shadow: 0 4px 15px 0 rgba(167, 139, 250, 0.4);
        }
        .modern-btn:hover {
            box-shadow: 0 6px 20px 0 rgba(167, 139, 250, 0.6); transform: translateY(-2px);
        }
        .modern-btn:disabled {
            background: #374151; box-shadow: none;
            cursor: not-allowed; transform: none;
        }
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .tag {
            display: inline-flex; align-items: center; gap: 0.25rem;
            padding: 0.25rem 0.75rem; font-size: 0.75rem; font-weight: 600;
            border-radius: 9999px; cursor: pointer; transition: transform 0.2s;
            border: 1px solid transparent;
        }
        .tag:hover { transform: translateY(-2px); }
        .modal-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center;
            z-index: 50; opacity: 0; visibility: hidden; transition: opacity 0.3s, visibility 0.3s;
        }
        .modal-overlay.visible { opacity: 1; visibility: visible; }
        .modal-content {
            background-color: rgba(13, 17, 32, 0.8);
            backdrop-filter: blur(24px); -webkit-backdrop-filter: blur(24px);
            border: 1px solid rgba(255, 255, 255, 0.1); padding: 1.5rem; border-radius: 1.5rem;
            width: 90%; max-width: 600px; transform: scale(0.95); transition: transform 0.3s;
            display: flex; flex-direction: column; max-height: 90vh;
        }
        .modal-overlay.visible .modal-content { transform: scale(1); }
        .modal-body { overflow-y: auto; padding-right: 1rem; }
        #notification { transition: opacity 0.5s, transform 0.5s; }
        .loader { display: flex; justify-content: center; align-items: center; flex-direction: column; gap: 1rem; color: #94a3b8; }
        .spinner {
            width: 56px; height: 56px; border-radius: 50%; border: 9px solid;
            border-color: #A78BFA; border-right-color: #374151; animation: spinner-d3wgkg 1s infinite linear;
        }
        @keyframes spinner-d3wgkg { to { transform: rotate(1turn); } }
        .fav-btn { color: #64748b; transition: color 0.2s; }
        .fav-btn.favorited { color: #facc15; }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        .shake {
            animation: shake 0.5s ease-in-out;
        }
        .hashtag-item {
             cursor: pointer;
             transition: background-color 0.2s;
        }
        .hashtag-item:hover {
            background-color: #4b5563; /* Corresponds to bg-slate-600 */
        }
    </style>
</head>
<body class="antialiased">

    <!-- Login Screen -->
    <div id="login-container" class="fixed inset-0 bg-gray-900 bg-opacity-80 flex items-center justify-center z-50">
        <div class="w-full max-w-sm p-8 glass-effect">
            <h2 class="text-2xl font-bold text-center text-white mb-6">Akses Terbatas</h2>
            <form id="login-form">
                <div class="mb-4">
                    <label for="username" class="block text-slate-300 mb-2">Username</label>
                    <input type="text" id="username" class="w-full rounded-lg p-3 modern-input" required value="username">
                </div>
                <div class="mb-6">
                    <label for="password" class="block text-slate-300 mb-2">Password</label>
                    <input type="password" id="password" class="w-full rounded-lg p-3 modern-input" required>
                    <p class="text-xs text-slate-500 mt-1">Hint: Follow Instagram @brata_putra</p>
                </div>
                <button type="submit" class="w-full text-white font-bold py-3 px-6 rounded-full text-lg modern-btn">Masuk</button>
                <p id="login-error" class="text-red-400 text-center mt-4 hidden">Username atau Password salah!</p>
            </form>
        </div>
    </div>
    
    <!-- Main App Container (Hidden by default) -->
    <div id="app-container" class="container mx-auto max-w-4xl p-4 md:p-8" style="display: none;">
        <header class="text-center mb-12 relative">
            <h1 class="text-4xl md:text-6xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-blue-400">CONTENT CHEAT</h1>
            <p class="text-slate-500 text-xs mt-1">v59.1</p>
            <p class="text-slate-400 mt-4 text-lg">Buat Ide Kontenmu dengan Sekali Klik</p>
            <a href="https://www.instagram.com/brata_putra" target="_blank" rel="noopener noreferrer" class="inline-block text-slate-500 hover:text-purple-400 transition-colors mt-2 text-sm">© Brata Hanggara Putra</a>
            <p class="text-red-500 text-xs font-bold mt-2">DILARANG MENJUAL KEMBALI TOOLS INI TANPA SEIZIN PENGEMBANG!</p>
             <div class="absolute top-0 right-0 flex gap-3">
                <button id="guideBtn" class="text-slate-400 hover:text-purple-400 transition-colors" title="Buka Pustaka Strategi Hook">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
                </button>
            </div>
        </header>
        <div class="p-8 glass-effect">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="topic" class="block text-sm font-medium text-slate-300 mb-2">1. Masukkan Produk / Jasa Anda <span class="text-red-400">(Wajib)</span></label>
                    <div class="flex items-center rounded-lg modern-input-group">
                         <input type="text" id="topic" class="w-full rounded-l-lg p-3 modern-input bg-transparent border-none" placeholder="Cth: Tripod, Serum Wajah">
                         <button id="topic-trend-btn" title="Cari Tren Topik" class="p-3 pr-4 text-slate-400 hover:text-purple-400 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>
                         </button>
                    </div>
                </div>
                <div>
                    <label for="audience" class="block text-sm font-medium text-slate-300 mb-2">2. Siapa Target Audiens Anda? <span class="text-slate-400">(Opsional)</span></label>
                    <input type="text" id="audience" class="w-full rounded-lg p-3 modern-input" placeholder="Cth: Konten Kreator, Pebisnis Online">
                </div>
                <div class="md:col-span-2">
                    <label for="details" class="block text-sm font-medium text-slate-300 mb-2">3. Detail Tambahan (Opsional)</label>
                    <input type="text" id="details" class="w-full rounded-lg p-3 modern-input" placeholder="Cth: Merk, Harga, Manfaat Utama">
                </div>
                <div>
                    <label for="hook-type" class="block text-sm font-medium text-slate-300 mb-2">4. Pilih Jenis Hasil (Opsional)</label>
                    <select id="hook-type" class="w-full rounded-lg p-3 modern-input">
                        <option value="semua">🔥 Tampilkan Semua (Direkomendasikan)</option>
                        <option value="Narasi">Narasi</option>
                        <option value="Pertanyaan">Pertanyaan</option>
                        <option value="Sebelum & Sesudah">Sebelum & Sesudah</option>
                        <option value="Social Proof">Social Proof</option>
                        <option value="Janji & Manfaat">Janji & Manfaat</option>
                        <option value="How-To">How-To</option>
                        <option value="Kontroversial">Kontroversial</option>
                        <option value="Negatif">Negatif</option>
                        <option value="FOMO">FOMO</option>
                        <option value="Penasaran">Penasaran</option>
                        <option value="Statistik">Statistik</option>
                        <option value="Kutipan">Kutipan</option>
                        <option value="Panggilan Langsung">Panggilan Langsung</option>
                    </select>
                </div>
                <div>
                    <label for="hook-count" class="block text-sm font-medium text-slate-300 mb-2">5. Jumlah Hasil (Opsional)</label>
                    <select id="hook-count" class="w-full rounded-lg p-3 modern-input">
                        <option value="5">5 Hasil</option>
                        <option value="10">10 Hasil</option>
                        <option value="15">15 Hasil</option>
                        <option value="20">20 Hasil</option>
                    </select>
                    <p class="text-xs text-slate-500 mt-1">Semakin sedikit, semakin cepat proses generate.</p>
                </div>
            </div>
            <div class="mt-8">
                <button id="generateBtn" class="w-full flex items-center justify-center gap-3 text-white font-bold py-4 px-6 rounded-full text-lg modern-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"></path><path d="M5 3v4"></path><path d="M19 17v4"></path><path d="M3 5h4"></path><path d="M17 19h4"></path></svg>
                    Generate Konten!
                </button>
            </div>
        </div>
        <div id="results-header" class="mt-10 mb-4 flex justify-between items-center" style="display: none;">
            <h2 class="text-2xl font-bold text-slate-300">Hasil Ide Konten</h2>
             <button id="showFavoritesBtn" class="flex items-center gap-2 bg-yellow-500/10 hover:bg-yellow-500/20 text-yellow-300 font-semibold py-2 px-4 rounded-full transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>
                Lihat Favorit (<span id="fav-count">0</span>)
            </button>
        </div>
        <div id="results">
            <div class="text-center text-slate-500 py-8">
                <p>Masukkan detail, dan biarkan AI berkreasi tanpa batas.</p>
            </div>
        </div>
    </div>
    <div id="topicTrendModal" class="modal-overlay"></div>
    <div id="scriptModal" class="modal-overlay"></div>
    <div id="favoritesModal" class="modal-overlay"></div>
    <div id="guideModal" class="modal-overlay"></div>
    <div id="category-info-modal" class="modal-overlay"></div>
    <div id="hashtag-action-modal" class="modal-overlay"></div>
    <div id="notification" class="fixed bottom-5 right-5 bg-green-600 text-white py-3 px-5 rounded-lg shadow-lg opacity-0 transform translate-y-10 transition-all duration-500 z-50">
        Pesan notifikasi
    </div>

    <script type="module">
        let generatedHooksAI = [];
        let favorites = []; 

        function showNotification(message, isError = false, customClass = '') {
            const notification = document.getElementById('notification');
            if(!notification) return;
            notification.textContent = message;
            notification.className = 'fixed bottom-5 right-5 text-white py-3 px-5 rounded-lg shadow-lg opacity-0 transform translate-y-10 transition-all duration-500 z-50';
            notification.classList.add(customClass || (isError ? 'bg-red-600' : 'bg-green-600'));
            setTimeout(() => { notification.classList.add('opacity-100', 'translate-y-0'); }, 10);
            setTimeout(() => { notification.classList.remove('opacity-100', 'translate-y-0'); }, 3000);
        }

        function copyToClipboard(text, buttonElement, copiedText = "Tersalin!") {
             const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            try {
                document.execCommand('copy');
                if (buttonElement) {
                    const originalText = buttonElement.innerHTML;
                    buttonElement.innerHTML = 'Tersalin!';
                    buttonElement.classList.add('copied');
                    setTimeout(() => { buttonElement.innerHTML = originalText; buttonElement.classList.remove('copied'); }, 2000);
                }
                 showNotification(copiedText);
            } catch (err) {
                showNotification('Oops, gagal menyalin teks.', true);
            }
            document.body.removeChild(textarea);
        }

        const hookGuideContent = { 
            'narasi': { title: "Narasi / Cerita", desc: "Membangun hubungan emosional dengan membagikan pengalaman pribadi (struggle & success). Sangat relateable.", effective: "Personal Branding, Produk Solutif" },
            'pertanyaan': { title: "Pertanyaan", desc: "Memicu interaksi dan membuat audiens merefleksikan masalah mereka sendiri. Mendorong komentar.", effective: "Semua Kategori" },
            'sebelum & sesudah': { title: "Sebelum & Sesudah", desc: "Menunjukkan transformasi nyata untuk membuktikan efektivitas produk/jasa. Sangat visual dan meyakinkan.", effective: "Produk Fisik, Jasa Skill, Kecantikan" },
            'social proof': { title: "Social Proof", desc: "Menggunakan bukti (testimoni, angka penjualan, ulasan) bahwa banyak orang lain telah percaya pada produk/jasa Anda.", effective: "Semua Kategori, terutama E-commerce" },
            'janji & manfaat': { title: "Janji & Manfaat", desc: "Memberikan janji nilai yang jelas dan langsung di awal video. Membuat audiens penasaran dengan hasilnya.", effective: "Jasa, Edukasi, Produk Solutif" },
            'how-to': { title: "How-To / Panduan", desc: "Memberikan solusi praktis dan memposisikan Anda sebagai ahli. Menawarkan nilai edukatif.", effective: "Produk, Jasa Skill, Edukasi" },
            'kontroversial': { title: "Kontroversial", desc: "Menantang keyakinan umum untuk menarik perhatian dan memicu diskusi (debat) di kolom komentar.", effective: "Opini, Personal Branding" },
            'negatif': { title: "Negatif / Peringatan", desc: "Memanfaatkan psikologi penghindaran kerugian (loss aversion). Memberi tahu kesalahan yang harus dihindari.", effective: "Semua Kategori" },
            'fomo': { title: "FOMO / Urgensi", desc: "Menciptakan kelangkaan (waktu atau jumlah) untuk mendorong tindakan cepat. Efektif untuk penjualan.", effective: "Produk Fisik, Promo, Event" },
            'penasaran': { title: "Penasaran", desc: "Menciptakan 'kesenjangan informasi' yang membuat audiens harus menonton sampai akhir untuk tahu jawabannya.", effective: "Semua Kategori" },
            'statistik': { title: "Statistik / Data", desc: "Menggunakan angka dan fakta untuk membangun kredibilitas dan urgensi. Terkesan lebih ilmiah.", effective: "Produk Kesehatan, Jasa Profesional, Teknologi" },
            'kutipan': { title: "Kutipan", desc: "Menggunakan kutipan terkenal untuk membangun koneksi dengan nilai yang dipegang audiens.", effective: "Motivasi, Personal Branding, Jasa Konsultasi" },
            'panggilan langsung': { title: "Panggilan Langsung", desc: "Menyebut target audiens secara spesifik untuk langsung merebut perhatian mereka. Efektif untuk niche market.", effective: "Semua Kategori" }
        };

        async function callNetlifyFunction(prompt) {
            const response = await fetch('/.netlify/functions/generate', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ prompt })
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error || `Netlify Function request failed: ${response.status}`);
            }
            return response.json();
        }

        async function generateAIHooks(topic, audience, details, hookType, hookCount) {
             const validCategories = ["Narasi", "Pertanyaan", "Sebelum & Sesudah", "Social Proof", "Janji & Manfaat", "How-To", "Kontroversial", "Negatif", "FOMO", "Penasaran", "Statistik", "Kutipan", "Panggilan Langsung"];
             let hookTypeInstruction = `Pastikan hasilnya mencakup berbagai jenis hook dari daftar kategori yang valid untuk memberikan variasi maksimal.`;
             if (hookType && hookType !== 'semua') {
                 hookTypeInstruction = `Fokus dan buat HANYA hook dengan kategori "${hookType}".`;
             }
             const prompt = `Anda adalah seorang content strategist AI yang sangat cerdas. Buat ${hookCount} hook video pendek yang sangat bervariasi untuk TikTok/Reels. ATURAN PALING UTAMA (WAJIB DIIKUTI): 1. **ANALISIS & PRIORITAS DETAIL:** Jika ada "Detail Tambahan", analisis dan pilih HANYA 1-2 detail paling kuat (nilai jual utama, keunikan, harga, atau manfaat emosional) untuk dijadikan materi hook. ABAIKAN detail sekunder seperti lokasi, topping/fitur umum, dll. 2. **ATURAN EMAS: HOOK WAJIB SUPER SINGKAT!** Setiap hook yang dihasilkan WAJIB pendek, padat, dan langsung menusuk rasa penasaran (idealnya di bawah 12 kata). 3. **BAHASA NATURAL & ANTI-JARGON:** Gunakan bahasa Indonesia sehari-hari yang mudah dimengerti. 4. **RELEVANSI KONTEKSTUAL 100%:** Semua output WAJIB 100% relevan dengan "Topik". 5. **LOGIKA KALIMAT & PERAN:** Pastikan struktur kalimat benar dan logis. 6. **STATISTIK CERDAS:** Jika menggunakan statistik, kaitkan dengan populasi yang jelas. 7. **KREATIVITAS & ANTI-PENGULANGAN:** DILARANG menggunakan frasa atau ide yang sama berulang kali. 8. **KATEGORI YANG VALID:** Untuk setiap hook, berikan "category" dengan memilih SATU string PERSIS dari daftar ini: ${JSON.stringify(validCategories)}. ${hookTypeInstruction} DATA: - Topik: "${topic}" - Audiens: "${audience || 'Umum'}" - Detail Tambahan: "${details || 'Tidak ada'}" Output harus berupa array JSON dari ${hookCount} objek, masing-masing dengan format: {"hook": "...", "category": "..."}.`;
             
             const result = await callNetlifyFunction(prompt);

             if (result.candidates?.[0]?.content?.parts?.[0]) {
                 const rawText = result.candidates[0].content.parts[0].text;
                 const cleanedText = rawText.replace(/```json/g, '').replace(/```/g, '').trim().replace(/,\s*([}\]])/g, "$1");
                 try {
                     const hooksArray = JSON.parse(cleanedText);
                     if (!Array.isArray(hooksArray)) throw new Error("Parsed data is not an array.");
                     return hooksArray.map(item => ({ html: item.hook, category: item.category }));
                 } catch (parseError) {
                     console.error("JSON Parsing Error in generateAIHooks:", parseError, "\nProblematic JSON string:", cleanedText);
                     throw new Error("Gagal memproses respons dari AI. Format data tidak sesuai.");
                 }
             }
             throw new Error("Struktur respons AI tidak terduga.");
        }
        
        async function openScriptModal(hookText) {
            const scriptModalEl = document.getElementById('scriptModal');
            scriptModalEl.classList.add('visible');
            scriptModalEl.innerHTML = `
                <div class="modal-content">
                    <div class="flex justify-between items-center mb-4 flex-shrink-0">
                        <h2 class="text-2xl font-bold text-cyan-400">✨ Kerangka Konten AI</h2>
                        <button class="close-modal-btn text-slate-400 hover:text-white text-3xl">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="loader"><div class="spinner"></div><p>AI sedang merancang skrip, audio, dan shot...</p></div>
                    </div>
                    <div class="modal-footer mt-6 pt-4 border-t border-slate-700 flex-shrink-0 flex flex-col sm:flex-row gap-2"></div>
                </div>
            `;
            
            const now = new Date();
            const currentMonthYear = new Intl.DateTimeFormat('id-ID', { month: 'long', year: 'numeric' }).format(now);
            const prompt = `Anda adalah seorang sutradara dan social media manager AI yang selalu update dengan tren terkini. Buat paket konten lengkap berdasarkan data berikut. ATURAN SANGAT PENTING: 1. **RELEVANSI 100%:** Semua output WAJIB relevan dengan "Produk/Jasa". 2. **AUDIO TRENDING TERBARU:** Berikan 1-2 judul lagu atau sound yang sedang sangat trending di TikTok/Reels dalam SATU BULAN TERAKHIR (saat ini adalah ${currentMonthYear}). Jangan berikan tren dari tahun lalu. 3. **SARAN SHOT:** Untuk setiap "visual", berikan "shot_suggestion" (contoh: "Close-up", "Top-down", "Slow motion"). 4. **DURASI:** Berikan 'durasi' dalam format "X-Y detik". 5. **CAPTION & HASHTAG:** 'caption' harus SANGAT SINGKAT (maks 2-3 kalimat, pisah dengan \\n). 'hashtags' tidak boleh ada di caption. DATA: - Produk/Jasa: "${document.getElementById('topic').value.trim()}" - Hook Video: "${hookText}" - Detail Tambahan: "${document.getElementById('details').value.trim() || 'Tidak ada'}" Format JSON WAJIB seperti ini: {"trending_audio": "...", "script": {"hook_scene": {"visual": "...", "shot_suggestion": "...", "narasi": "...", "durasi": "..."}, "masalah": {"visual": "...", "shot_suggestion": "...", "narasi": "...", "durasi": "..."}, "solusi": {"visual": "...", "shot_suggestion": "...", "narasi": "...", "durasi": "..."}, "info_produk": {"visual": "...", "shot_suggestion": "...", "narasi": "...", "durasi": "..."}, "cta": {"visual": "...", "shot_suggestion": "...", "narasi": "...", "durasi": "..."}}, "caption": "...", "hashtags": "..."}`;
            
            try {
                const result = await callNetlifyFunction(prompt);
                
                const rawText = result.candidates[0].content.parts[0].text;
                let cleanedText = rawText.replace(/```json/g, '').replace(/```/g, '').trim().replace(/,\s*([}\]])/g, "$1");

                const data = JSON.parse(cleanedText);
                
                let cumulativeTime = 0;
                const scriptContainer = document.createElement('div');
                scriptContainer.className = 'space-y-4';

                if(data.trending_audio) {
                    scriptContainer.innerHTML += `
                        <div class="p-4 rounded-lg bg-purple-900/30">
                            <h3 class="font-bold text-lg text-purple-400 mb-2">🎵 Saran Audio Trending</h3>
                            <p class="text-purple-200/90">${data.trending_audio}</p>
                        </div>
                    `;
                }

                const sceneKeys = ['hook_scene', 'masalah', 'solusi', 'info_produk', 'cta'];
                const sceneTitles = ['🎬 Hook (Scene)', '🤔 Masalah', '💡 Solusi', 'ℹ️ Info Produk', '🚀 CTA'];
                const sceneColors = ['text-emerald-400', 'text-rose-400', 'text-sky-400', 'text-amber-400', 'text-lime-400'];

                sceneKeys.forEach((key, index) => {
                    const sceneData = data.script?.[key];
                    if (sceneData) {
                        const durationString = sceneData.durasi || "0 detik";
                        const durationMatch = durationString.match(/(\d+)/g);
                        const sceneDuration = durationMatch ? parseInt(durationMatch[durationMatch.length - 1], 10) : 0;
                        const startTime = cumulativeTime;
                        const endTime = cumulativeTime + sceneDuration;
                        scriptContainer.innerHTML += createEditableSection(key, sceneTitles[index], sceneData, sceneColors[index], startTime, endTime, sceneDuration);
                        cumulativeTime = endTime;
                    }
                });
                
                scriptContainer.innerHTML += createEditableSection('caption', '✍️ Caption', {caption: data.caption}, 'text-indigo-400');
                scriptContainer.innerHTML += createEditableSection('hashtags', '#️⃣ Hashtags', {hashtags: data.hashtags}, 'text-fuchsia-400');

                scriptModalEl.querySelector('.modal-body').innerHTML = `<div id="script-content-container">${scriptContainer.innerHTML}</div>`;
                setupModalFooter();
            } catch (error) {
                console.error("Script Generation/Parsing Error:", error);
                scriptModalEl.querySelector('.modal-body').innerHTML = `<p class="text-center text-red-400">Gagal membuat script. ${error.message}. Silakan coba lagi.</p>`;
            }
        }
        
        function displayHooks(hooks) {
            const resultsContainer = document.getElementById('results');
            const resultsHeader = document.getElementById('results-header');
            if (!resultsContainer || !resultsHeader) return;
            resultsContainer.innerHTML = '';
            if (!hooks || hooks.length === 0) {
                resultsContainer.innerHTML = `<div class="text-center text-slate-500 py-8"><p>Tidak ada hasil yang ditemukan. Coba kata kunci lain.</p></div>`;
                resultsHeader.style.display = 'none';
                return;
            }
            resultsHeader.style.display = 'flex';
            updateFavCount();
            const resultsGrid = document.createElement('div');
            resultsGrid.className = 'grid grid-cols-1 gap-4';
            hooks.forEach((hookData, index) => {
                const isFavorited = favorites.some(fav => fav.html === hookData.html);
                const card = createHookCard(hookData, index, isFavorited);
                resultsGrid.appendChild(card);
            });
            resultsContainer.appendChild(resultsGrid);
        }
        
        function createHookCard(hookData, index, isFavorited) {
            const { html, category } = hookData;
            const card = document.createElement('div');
            card.className = 'bg-slate-800/20 backdrop-blur-sm border border-slate-700/50 p-5 rounded-xl flex items-start gap-4 fade-in';
            const favButton = document.createElement('button');
            favButton.className = `fav-btn ${isFavorited ? 'favorited' : ''}`;
            favButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>`;
            favButton.onclick = () => toggleFavorite(hookData);
            const mainContent = document.createElement('div');
            mainContent.className = 'flex-grow';
            const textContainer = document.createElement('div');
            const categoryColors = { 'janji & manfaat': 'bg-yellow-500/10 text-yellow-300 border-yellow-500/20', 'narasi': 'bg-sky-500/10 text-sky-300 border-sky-500/20', 'pertanyaan': 'bg-amber-500/10 text-amber-300 border-amber-500/20', 'how-to': 'bg-emerald-500/10 text-emerald-300 border-emerald-500/20', 'kontroversial': 'bg-red-500/10 text-red-300 border-red-500/20', 'negatif': 'bg-rose-500/10 text-rose-300 border-rose-500/20', 'fomo': 'bg-orange-500/10 text-orange-300 border-orange-500/20', 'penasaran': 'bg-purple-500/10 text-purple-300 border-purple-500/20', 'social proof': 'bg-teal-500/10 text-teal-300 border-teal-500/20', 'sebelum & sesudah': 'bg-lime-500/10 text-lime-300 border-lime-500/20', 'panggilan langsung': 'bg-fuchsia-500/10 text-fuchsia-300 border-fuchsia-500/20', 'kutipan': 'bg-gray-500/10 text-gray-300 border-gray-500/20', 'statistik': 'bg-indigo-500/10 text-indigo-300 border-indigo-500/20' };
            if (category) {
                const categoryTag = document.createElement('span');
                categoryTag.className = `tag ${categoryColors[category.toLowerCase()] || 'bg-cyan-500/10 text-cyan-300 border-cyan-500/20'} mb-3`;
                categoryTag.textContent = category;
                categoryTag.onclick = () => openCategoryInfoModal(category);
                textContainer.append(categoryTag);
            }
            const hookTextP = document.createElement('p');
            hookTextP.className = 'text-slate-200 text-lg';
            hookTextP.innerHTML = html;
            textContainer.append(hookTextP);
            const buttonGroup = document.createElement('div');
            buttonGroup.className = 'flex-shrink-0 flex items-center gap-2 mt-4';
            const copyButton = document.createElement('button');
            copyButton.className = 'copy-btn text-xs font-semibold bg-slate-700/50 hover:bg-slate-700 text-slate-300 py-2 px-4 rounded-full transition-colors';
            copyButton.textContent = 'Salin';
            copyButton.onclick = (e) => copyToClipboard(hookTextP.innerText, e.currentTarget);
            const developButton = document.createElement('button');
            developButton.className = 'text-xs font-semibold bg-purple-600/50 hover:bg-purple-600 text-purple-200 py-2 px-4 rounded-full transition-colors flex items-center justify-center gap-2';
            developButton.innerHTML = '✨ Buat Script';
            developButton.onclick = (e) => {
                if (e.target.closest('#favoritesModal')) {
                    document.getElementById('favoritesModal').classList.remove('visible');
                }
                openScriptModal(hookTextP.innerText);
            };
            buttonGroup.append(copyButton, developButton);
            mainContent.append(textContainer, buttonGroup);
            card.append(favButton, mainContent);
            return card;
        }

        function openCategoryInfoModal(categoryKey) {
            const categoryInfoModalEl = document.getElementById('category-info-modal');
            if (!categoryInfoModalEl) return;

            const normalizedKey = categoryKey.toLowerCase();
            const categoryData = hookGuideContent[normalizedKey];
            
            if (!categoryData) {
                console.error(`No data found for category key: ${normalizedKey}`);
                return;
            }

            categoryInfoModalEl.innerHTML = `
                <div class="modal-content">
                    <div class="flex justify-between items-center mb-4 flex-shrink-0">
                        <h2 class="text-2xl font-bold text-purple-400">${categoryData.title}</h2>
                        <button class="close-modal-btn text-slate-400 hover:text-white text-3xl">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="space-y-4">
                            <div>
                                <h3 class="font-semibold text-lg text-slate-300">Deskripsi</h3>
                                <p class="text-slate-400 mt-1">${categoryData.desc}</p>
                            </div>
                            <div>
                                <h3 class="font-semibold text-lg text-slate-300">Paling Efektif Untuk</h3>
                                <p class="text-amber-400 mt-1">${categoryData.effective}</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            categoryInfoModalEl.classList.add('visible');
        }
        
        function createEditableSection(key, title, data, titleColor, startTime, endTime, sceneDuration) {
            let contentHtml, editText, durationHtml;
            const visualText = data.visual || '';
            const narasiText = data.narasi || '';
            const shotSuggestion = data.shot_suggestion ? `🎬 Saran Shot: ${data.shot_suggestion}` : '';

            if (key === 'caption') {
                editText = data.caption || "";
                contentHtml = `<p class="text-slate-300 mt-1 whitespace-pre-wrap caption-content">${editText.replace(/\\n/g, '\n')}</p>`;
            } else if (key === 'hashtags') {
                editText = data.hashtags || "";
                let tagsHtml = '';
                let hashtagsArray = [];

                if (Array.isArray(editText)) {
                    hashtagsArray = editText;
                    editText = hashtagsArray.join(' '); 
                } else if (typeof editText === 'string') {
                    hashtagsArray = editText.split(/\s+/);
                }
                
                tagsHtml = hashtagsArray.filter(tag => typeof tag === 'string' && tag.startsWith('#')).map(tag => `<span class="hashtag-item bg-slate-700 text-slate-300 p-1 px-3 rounded-full text-sm">${tag}</span>`).join(' ');
                contentHtml = `<div class="flex flex-wrap gap-2 mt-2 hashtag-content">${tagsHtml}</div>`;
            } else {
                durationHtml = `🕒 Detik ${startTime}-${endTime} (Estimasi: ${sceneDuration} detik)`;
                contentHtml = `
                    <p class="text-slate-400 text-sm font-semibold duration-text">${durationHtml}</p>
                    <div class="mt-1 space-y-2">
                        <div>
                            <span class="text-xs font-semibold text-slate-400">📸 VISUAL:</span>
                            <p class="text-slate-300 text-sm visual-content">${visualText}</p>
                        </div>
                        <div>
                            <span class="text-xs font-semibold text-slate-400">🎙️ NARASI:</span>
                            <p class="text-slate-300 text-sm narasi-content">${narasiText}</p>
                        </div>
                        <div>
                            <span class="block text-xs text-cyan-400/80 mt-1 shot-suggestion-text">${shotSuggestion}</span>
                        </div>
                    </div>
                `;
                editText = `DURASI: ${durationHtml}\n\nVISUAL:\n${visualText}\n\nNARASI:\n${narasiText}\n\n${shotSuggestion}`;
            }

            return `
                <div class="editable-section p-4 rounded-lg bg-slate-900/50" data-key="${key}">
                    <div class="display-view">
                        <div class="flex justify-between items-center mb-2">
                            <h3 class="font-bold text-lg ${titleColor}">${title}</h3>
                            <div class="flex items-center gap-2">
                                <button class="copy-section-btn p-1 text-slate-400 hover:text-white" title="Salin Bagian Ini"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg></button>
                                <button class="edit-btn p-1 text-slate-400 hover:text-white" title="Ubah Bagian Ini"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path></svg></button>
                            </div>
                        </div>
                        ${contentHtml}
                    </div>
                    <div class="edit-view hidden">
                        <textarea class="w-full text-slate-200 bg-slate-800 rounded-md p-2 h-40">${editText.trim()}</textarea>
                        <div class="flex gap-2 mt-2">
                            <button class="save-btn flex-1 bg-green-600 hover:bg-green-700 text-white text-sm py-1 rounded">Simpan</button>
                            <button class="cancel-btn flex-1 bg-slate-600 hover:bg-slate-700 text-white text-sm py-1 rounded">Batal</button>
                        </div>
                    </div>
                </div>`;
        }
        
        function openHashtagActionModal(tag) {
            const hashtagActionModalEl = document.getElementById('hashtag-action-modal');
            if (!hashtagActionModalEl) return;

            const cleanedTag = tag.replace('#', '');
            const instagramUrl = `https://www.instagram.com/explore/tags/${cleanedTag}/`;
            const tiktokUrl = `https://www.tiktok.com/tag/${cleanedTag}`;

            hashtagActionModalEl.innerHTML = `
                <div class="modal-content !max-w-sm">
                    <div class="flex justify-between items-center mb-4 flex-shrink-0">
                        <h2 class="text-xl font-bold text-fuchsia-400">${tag}</h2>
                        <button class="close-modal-btn text-slate-400 hover:text-white text-3xl">&times;</button>
                    </div>
                    <div>
                        <p class="text-slate-400 mb-4">Lihat popularitas dan konten terkait untuk tag ini di platform berikut:</p>
                        <div class="space-y-3">
                            <a href="${instagramUrl}" target="_blank" rel="noopener noreferrer" class="flex items-center justify-center gap-3 w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white font-semibold py-3 px-4 rounded-lg transition-transform hover:scale-105">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line></svg>
                                Lihat di Instagram
                            </a>
                            <a href="${tiktokUrl}" target="_blank" rel="noopener noreferrer" class="flex items-center justify-center gap-3 w-full bg-black text-white font-semibold py-3 px-4 rounded-lg transition-transform hover:scale-105 border border-slate-700">
                                 <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12.525.02c1.31-.02 2.61-.01 3.91-.02.08 1.53.63 3.09 1.75 4.17 1.12 1.11 2.7 1.62 4.24 1.79v4.03c-1.44-.05-2.89-.35-4.2-.97-.57-.26-1.1-.59-1.62-.93-.01 2.92.01 5.84-.02 8.75-.08 1.4-.54 2.79-1.35 3.94-1.31 1.92-3.58 3.17-5.91 3.21-1.43.08-2.86-.31-4.08-1.03-2.02-1.19-3.44-3.37-3.65-5.71-.02-.5-.03-1-.01-1.49.18-1.9 1.12-3.72 2.58-4.96 1.66-1.44 3.98-2.13 6.15-1.72.02 1.48-.04 2.96-.04 4.44-.99-.32-2.15-.23-3.02.37-.63.41-1.11 1.04-1.36 1.75-.21.51-.15 1.07-.14 1.61.24 1.64 1.82 3.02 3.5 2.87 1.12-.01 2.19-.66 2.77-1.61.19-.33.4-.67.41-1.06.1-1.79.06-3.57.07-5.36.01-4.03-.01-8.05.02-12.07z"/></svg>
                                Lihat di TikTok
                            </a>
                        </div>
                    </div>
                </div>
            `;
            hashtagActionModalEl.classList.add('visible');
        }

        function setupModalFooter() {
             const modalFooter = document.getElementById('scriptModal').querySelector('.modal-footer');
            if(modalFooter) {
                modalFooter.innerHTML = `
                    <button id="copyScriptBtn" class="flex-1 text-sm font-semibold bg-indigo-800 hover:bg-indigo-700 text-white py-2 px-4 rounded-full transition-colors">Salin Semua</button>
                    <button id="downloadDocBtn" class="flex-1 text-sm font-semibold bg-blue-800 hover:bg-blue-700 text-white py-2 px-4 rounded-full transition-colors">Download .doc</button>
                    <button id="exportGDocsBtn" class="flex-1 text-sm font-semibold bg-green-800 hover:bg-green-700 text-white py-2 px-4 rounded-full transition-colors">Export ke GDocs</button>
                `;
                document.getElementById('copyScriptBtn').onclick = (e) => copyFullScript(e.currentTarget);
                document.getElementById('downloadDocBtn').onclick = () => downloadDoc(getFullScriptText(), document.getElementById('topic').value.trim());
                document.getElementById('exportGDocsBtn').onclick = () => exportToGoogleDocs(getFullScriptText());
            }
        }

        function getFullScriptText() {
            let fullText = `Konten untuk: ${document.getElementById('topic').value.trim()}\n\n`;
            const audio = document.querySelector('#scriptModal .modal-body .p-4.bg-purple-900\\/30');
            if(audio) fullText += `--- SARAN AUDIO TRENDING ---\n${audio.querySelector('p').textContent}\n\n`;
            
            document.querySelectorAll('#scriptModal .editable-section').forEach(section => {
                const title = section.querySelector('h3').textContent;
                const content = section.querySelector('textarea').value;
                fullText += `--- ${title.toUpperCase()} ---\n${content}\n\n`;
            });
            return fullText.trim();
        }

        function copyFullScript(buttonElement) { copyToClipboard(getFullScriptText(), buttonElement, "Semua Tersalin!"); }
        
        function downloadDoc(content, topic) {
            const sourceHTML = "<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'><head><meta charset='utf-8'><title>Export</title></head><body>" + content.replace(/\n/g, '<br>') + "</body></html>";
            const source = 'data:application/vnd.ms-word;charset=utf-8,' + encodeURIComponent(sourceHTML);
            const fileDownload = document.createElement("a");
            document.body.appendChild(fileDownload);
            fileDownload.href = source;
            fileDownload.download = `konten-${topic.replace(/ /g, '-')}.doc`;
            fileDownload.click();
            document.body.removeChild(fileDownload);
            showNotification('Dokumen .doc sedang diunduh!');
        }
        
        function exportToGoogleDocs(content) {
            copyToClipboard(content, null);
            showNotification('Script disalin! Paste (Ctrl+V) di tab Google Docs yang baru.');
            window.open('https://docs.google.com/document/create', '_blank');
        }

        function loadFavoritesFromLocalStorage() {
            const storedFavorites = localStorage.getItem('contentCheatFavorites');
            favorites = storedFavorites ? JSON.parse(storedFavorites) : [];
            updateFavCount();
        }

        function saveFavoritesToLocalStorage() {
            localStorage.setItem('contentCheatFavorites', JSON.stringify(favorites));
        }

        function toggleFavorite(hookData) {
            const index = favorites.findIndex(fav => fav.html === hookData.html);
            if (index > -1) {
                favorites.splice(index, 1);
                showNotification('Dihapus dari favorit.', true, 'bg-slate-600');
            } else {
                favorites.push(hookData);
                showNotification('Disimpan ke favorit!');
            }
            saveFavoritesToLocalStorage();
            updateFavCount();
            if (generatedHooksAI.length > 0) {
                displayHooks(generatedHooksAI);
            }
        }

        function updateFavCount() {
             const favCountSpan = document.getElementById('fav-count');
             if(favCountSpan) favCountSpan.textContent = favorites.length;
        }

        function openFavoritesModal() {
            const favoritesModalEl = document.getElementById('favoritesModal');
            favoritesModalEl.innerHTML = `
                <div class="modal-content">
                    <div class="flex justify-between items-center mb-4 flex-shrink-0">
                        <h2 class="text-2xl font-bold text-yellow-400">⭐ Ide Favorit Anda</h2>
                        <button class="close-modal-btn text-slate-400 hover:text-white text-3xl">&times;</button>
                    </div>
                    <div class="modal-body">
                        ${favorites.length === 0 ? '<p class="text-center text-slate-500 py-8">Anda belum menyimpan ide favorit.</p>' : ''}
                    </div>
                </div>
            `;
            if (favorites.length > 0) {
                const favGrid = document.createElement('div');
                favGrid.className = 'grid grid-cols-1 gap-4';
                favorites.forEach((hookData, index) => {
                    const card = createHookCard(hookData, index, true);
                    favGrid.appendChild(card);
                });
                favoritesModalEl.querySelector('.modal-body').appendChild(favGrid);
            }
            favoritesModalEl.classList.add('visible');
        }

        function handleLogin() {
            const loginContainer = document.getElementById('login-container');
            const appContainer = document.getElementById('app-container');
            const loginForm = document.getElementById('login-form');
            const usernameInput = document.getElementById('username');
            const passwordInput = document.getElementById('password');
            const loginError = document.getElementById('login-error');

            if (!loginForm) return;

            loginForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const username = usernameInput.value.trim();
                const password = passwordInput.value.trim();

                if (username === 'username' && password === 'followIG@brata_putra') {
                    loginContainer.style.display = 'none';
                    appContainer.style.display = 'block';
                    appContainer.classList.add('fade-in');
                } else {
                    loginError.classList.remove('hidden');
                    passwordInput.value = ''; 
                    const loginBox = loginContainer.querySelector('.glass-effect');
                    loginBox.classList.add('shake');
                    setTimeout(() => {
                        loginBox.classList.remove('shake');
                    }, 500);
                }
            });
        }

        function initializeAppLogic() {
            handleLogin(); 
            loadFavoritesFromLocalStorage(); 

            const generateBtn = document.getElementById('generateBtn');
            const showFavoritesBtn = document.getElementById('showFavoritesBtn');
            const guideBtn = document.getElementById('guideBtn');
            
            if (generateBtn) {
                generateBtn.addEventListener('click', async () => {
                     const topicInput = document.getElementById('topic');
                     const audienceInput = document.getElementById('audience');
                     const detailsInput = document.getElementById('details');
                     const hookTypeSelect = document.getElementById('hook-type');
                     const hookCountSelect = document.getElementById('hook-count');
                     const resultsContainer = document.getElementById('results');
                     const resultsHeader = document.getElementById('results-header');

                     const topic = topicInput.value.trim();
                     if (!topic) {
                         showNotification('Mohon isi Produk / Jasa Anda terlebih dahulu.', true);
                         topicInput.focus();
                         return;
                     }
                     generateBtn.disabled = true;
                     generateBtn.innerHTML = '<div class="spinner !w-6 !h-6 !border-4"></div><span>Generating...</span>';
                     if (resultsContainer) resultsContainer.innerHTML = `<div class="loader"><div class="spinner"></div><p>AI sedang berpikir keras... 😉</p></div>`;
                     if (resultsHeader) resultsHeader.style.display = 'none';
                     try {
                         const hooks = await generateAIHooks(topic, audienceInput.value.trim(), detailsInput.value.trim(), hookTypeSelect.value, hookCountSelect.value);
                         generatedHooksAI = hooks;
                         displayHooks(hooks);
                     } catch (error) {
                         console.error('AI Generation Error:', error);
                         if (resultsContainer) resultsContainer.innerHTML = `<div class="text-center text-red-400 py-8"><p>${error.message || 'Maaf, terjadi kesalahan saat menghubungi AI.'}</p></div>`;
                     }
                     generateBtn.disabled = false;
                     generateBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"></path><path d="M5 3v4"></path><path d="M19 17v4"></path><path d="M3 5h4"></path><path d="M17 19h4"></path></svg> Generate Konten!`;
                });
            }
            if (showFavoritesBtn) {
                showFavoritesBtn.addEventListener('click', openFavoritesModal);
            }
            if (guideBtn) {
                 guideBtn.addEventListener('click', () => { 
                    const guideModalEl = document.getElementById('guideModal');
                    guideModalEl.innerHTML = `
                        <div class="modal-content">
                            <div class="flex justify-between items-center mb-4 flex-shrink-0">
                                <h2 class="text-2xl font-bold text-purple-400">📚 Pustaka Strategi Hook</h2>
                                <button class="close-modal-btn text-slate-400 hover:text-white text-3xl">&times;</button>
                            </div>
                            <div class="modal-body"></div>
                        </div>
                    `;
                    let contentHtml = '<div class="space-y-6">';
                    for (const key in hookGuideContent) {
                        const item = hookGuideContent[key];
                        contentHtml += `<div><h3 class="font-bold text-lg text-purple-400">${item.title}</h3><p class="text-slate-300 mt-1">${item.desc}</p><p class="text-xs mt-2 font-semibold text-amber-400">Efektif untuk: <span class="font-normal text-slate-300">${item.effective}</span></p></div>`;
                    }
                    guideModalEl.querySelector('.modal-body').innerHTML = contentHtml + '</div>';
                    guideModalEl.classList.add('visible');
                 });
            }
            
            document.body.addEventListener('click', async (e) => {
                const closest = (selector) => e.target.closest(selector);

                if (closest('.close-modal-btn') || e.target.classList.contains('modal-overlay')) {
                    const modal = closest('.modal-overlay');
                    if (modal) modal.classList.remove('visible');
                    return;
                }

                const hashtagItem = closest('.hashtag-item');
                if (hashtagItem) {
                    openHashtagActionModal(hashtagItem.textContent);
                    return;
                }

                const editableSection = closest('.editable-section');
                if (editableSection) {
                    if (closest('.edit-btn')) {
                        editableSection.querySelector('.display-view').classList.add('hidden');
                        editableSection.querySelector('.edit-view').classList.remove('hidden');
                    } else if (closest('.cancel-btn')) {
                        editableSection.querySelector('.display-view').classList.remove('hidden');
                        editableSection.querySelector('.edit-view').classList.add('hidden');
                        showNotification('Batal mengedit', false, 'bg-slate-600');
                    } else if (closest('.save-btn')) {
                        const textarea = editableSection.querySelector('textarea');
                        const key = editableSection.dataset.key;
                        const displayView = editableSection.querySelector('.display-view');
                        
                        if (displayView.querySelector('.duration-text')) {
                            const newText = textarea.value;
                            
                            const durationMatch = newText.match(/^DURASI:\s*(.*)/m);
                            const visualMatch = newText.match(/VISUAL:\s*([\s\S]*?)(?=\n\nNARASI:|$)/m);
                            const narasiMatch = newText.match(/NARASI:\s*([\s\S]*?)(?=\n\n🎬|$)/m);
                            const shotMatch = newText.match(/🎬\s*Saran Shot:\s*(.*)/m);

                            if(durationMatch) displayView.querySelector('.duration-text').textContent = durationMatch[1].trim();
                            if(visualMatch) displayView.querySelector('.visual-content').innerHTML = visualMatch[1].trim().replace(/\n/g, '<br>');
                            if(narasiMatch) displayView.querySelector('.narasi-content').innerHTML = narasiMatch[1].trim().replace(/\n/g, '<br>');
                            if(shotMatch) displayView.querySelector('.shot-suggestion-text').textContent = `🎬 Saran Shot: ${shotMatch[1].trim()}`;
                            else displayView.querySelector('.shot-suggestion-text').textContent = '';
                            
                        } else if (key === 'caption') {
                            displayView.querySelector('.caption-content').innerHTML = textarea.value.replace(/\n/g, '<br>');
                        } else if (key === 'hashtags') {
                            const tagsHtml = textarea.value.split(/\s+/).filter(tag => tag.startsWith('#')).map(tag => `<span class="hashtag-item bg-slate-700 text-slate-300 p-1 px-3 rounded-full text-sm">${tag}</span>`).join(' ');
                            displayView.querySelector('.hashtag-content').innerHTML = tagsHtml;
                        }

                        displayView.classList.remove('hidden');
                        editableSection.querySelector('.edit-view').classList.add('hidden');
                        showNotification('Bagian berhasil diperbarui!');

                    } else if (closest('.copy-section-btn')) {
                        const textarea = editableSection.querySelector('textarea');
                        copyToClipboard(textarea.value, closest('.copy-section-btn'), 'Bagian tersalin!');
                    }
                }
            });
        }
        document.addEventListener('DOMContentLoaded', initializeAppLogic);
    </script>
</body>
</html>